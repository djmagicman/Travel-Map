–Ø –¥–æ–±–∞–≤–ª—é –Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –≤ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:

1. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –º–µ—Ç–æ–∫ –ø–æ —Ü–≤–µ—Ç—É
2. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Å–µ—â–µ–Ω–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤
3. –≠–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç –º–µ—Ç–æ–∫
4. –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –º–µ—Ç–æ–∫
5. –†–µ–∂–∏–º "–ú–µ—á—Ç—ã –æ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è—Ö"

–í–æ—Ç —É–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –∫–æ–¥–∞ —Å –Ω–æ–≤—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏:

/begin_artifact('improved_travel_map.html', 'html')
```html
<!DOCTYPE html>
<html lang="ru">
<head>
    <!-- [–í–µ—Å—å –ø—Ä–µ–¥—ã–¥—É—â–∏–π head –∫–æ–¥ –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π] -->
    
    <!-- –î–æ–±–∞–≤–∏–º CSS –¥–ª—è –Ω–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ -->
    <style>
        /* –ù–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–∞–Ω–µ–ª–µ–π */
        #statisticsPanel, #exportImportPanel {
            background: var(--bg-dark);
            padding: 15px;
            margin-top: 15px;
            border-radius: var(--border-radius);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .stat-card {
            background: var(--bg-light);
            padding: 10px;
            border-radius: var(--border-radius);
            text-align: center;
        }

        #filterColorInput {
            width: 100%;
            margin-bottom: 10px;
        }

        #dreamTravelMode {
            margin-top: 15px;
            background-color: var(--accent-color);
            color: white;
        }
    </style>
</head>
<body>
    <!-- [–°—É—â–µ—Å—Ç–≤—É—é—â–∏–π HTML –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π] -->

    <!-- –î–æ–±–∞–≤–∏–º –Ω–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –≤ controls -->
    <div id="controls">
        <!-- [–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è] -->

        <!-- –ù–æ–≤–∞—è —Å–µ–∫—Ü–∏—è: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div id="statisticsPanel">
            <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π</h3>
            <div class="stats-grid">
                <div class="stat-card">
                    <strong>–ì–æ—Ä–æ–¥–æ–≤</strong>
                    <div id="totalCitiesCount">0</div>
                </div>
                <div class="stat-card">
                    <strong>–°—Ç—Ä–∞–Ω</strong>
                    <div id="totalCountriesCount">0</div>
                </div>
            </div>
        </div>

        <!-- –§–∏–ª—å—Ç—Ä –ø–æ —Ü–≤–µ—Ç—É -->
        <div>
            <label>–§–∏–ª—å—Ç—Ä –ø–æ —Ü–≤–µ—Ç—É:</label>
            <input type="color" id="filterColorInput" />
            <button id="applyColorFilterBtn">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä</button>
            <button id="resetColorFilterBtn">–°–±—Ä–æ—Å–∏—Ç—å</button>
        </div>

        <!-- –≠–∫—Å–ø–æ—Ä—Ç/–ò–º–ø–æ—Ä—Ç -->
        <div id="exportImportPanel">
            <h3>üì§ –≠–∫—Å–ø–æ—Ä—Ç/–ò–º–ø–æ—Ä—Ç</h3>
            <button id="exportMarkersBtn">–≠–∫—Å–ø–æ—Ä—Ç –º–µ—Ç–æ–∫</button>
            <button id="importMarkersBtn">–ò–º–ø–æ—Ä—Ç –º–µ—Ç–æ–∫</button>
            <input type="file" id="importFileInput" style="display:none" accept=".json" />
        </div>

        <!-- –†–µ–∂–∏–º –º–µ—á—Ç—ã –æ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è—Ö -->
        <button id="dreamTravelMode">‚úàÔ∏è –†–µ–∂–∏–º –º–µ—á—Ç—ã</button>
    </div>

    <!-- –°–∫—Ä–∏–ø—Ç —Å –Ω–æ–≤—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏ -->
    <script type="module">
        // [–ü—Ä–µ–¥—ã–¥—É—â–∏–π Firebase —Å–∫—Ä–∏–ø—Ç –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π]

        // –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

        // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        async function updateStatistics(markers) {
            const cities = new Set(markers.map(m => m.data.cityName));
            const countries = new Set(markers.map(m => extractCountry(m.data.cityName)));

            document.getElementById('totalCitiesCount').textContent = cities.size;
            document.getElementById('totalCountriesCount').textContent = countries.size;
        }

        function extractCountry(cityName) {
            const parts = cityName.split(',');
            return parts[parts.length - 1].trim();
        }

        // –§–∏–ª—å—Ç—Ä –ø–æ —Ü–≤–µ—Ç—É
        const filterColorInput = document.getElementById('filterColorInput');
        const applyColorFilterBtn = document.getElementById('applyColorFilterBtn');
        const resetColorFilterBtn = document.getElementById('resetColorFilterBtn');

        applyColorFilterBtn.addEventListener('click', () => {
            const selectedColor = filterColorInput.value;
            markers.forEach(({marker, data}) => {
                if (data.color !== selectedColor) {
                    map.removeLayer(marker);
                } else {
                    marker.addTo(map);
                }
            });
        });

        resetColorFilterBtn.addEventListener('click', () => {
            markers.forEach(({marker}) => marker.addTo(map));
        });

        // –≠–∫—Å–ø–æ—Ä—Ç/–ò–º–ø–æ—Ä—Ç
        const exportMarkersBtn = document.getElementById('exportMarkersBtn');
        const importMarkersBtn = document.getElementById('importMarkersBtn');
        const importFileInput = document.getElementById('importFileInput');

        exportMarkersBtn.addEventListener('click', () => {
            const markersData = markers.map(m => m.data);
            const blob = new Blob([JSON.stringify(markersData)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'travel_markers.json';
            a.click();
        });

        importMarkersBtn.addEventListener('click', () => {
            importFileInput.click();
        });

        importFileInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = async (event) => {
                try {
                    const importedMarkers = JSON.parse(event.target.result);
                    const user = auth.currentUser;
                    if (!user) {
                        showNotification("–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç", true);
                        return;
                    }

                    for (let markerData of importedMarkers) {
                        await saveMarker(
                            user.uid, 
                            markerData.cityName, 
                            markerData.lat, 
                            markerData.lon, 
                            markerData.color
                        );
                    }
                    showNotification("–ú–µ—Ç–∫–∏ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!");
                    loadUserMarkers(user.uid);
                } catch (error) {
                    showNotification("–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ –º–µ—Ç–æ–∫", true);
                }
            };
            reader.readAsText(file);
        });

        // –†–µ–∂–∏–º –º–µ—á—Ç—ã –æ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è—Ö
        const dreamTravelModeBtn = document.getElementById('dreamTravelMode');
        let dreamMode = false;

        dreamTravelModeBtn.addEventListener('click', () => {
            dreamMode = !dreamMode;
            dreamTravelModeBtn.style.opacity = dreamMode ? 0.7 : 1;
            
            if (dreamMode) {
                markers.forEach(({marker, data}) => {
                    marker.setStyle({
                        fillOpacity: 0.3,
                        color: 'gray'
                    });
                });
                showNotification("–í–∫–ª—é—á–µ–Ω —Ä–µ–∂–∏–º –º–µ—á—Ç—ã –æ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è—Ö");
            } else {
                markers.forEach(({marker, data}) => {
                    marker.setStyle({
                        color: data.color,
                        fillOpacity: 0.7
                    });
                });
                showNotification("–†–µ–∂–∏–º –º–µ—á—Ç—ã –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω");
            }
        });

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –º–∞—Ä–∫–µ—Ä–æ–≤
        const originalLoadUserMarkers = loadUserMarkers;
        loadUserMarkers = async (userId) => {
            await originalLoadUserMarkers(userId);
            updateStatistics(markers);
        };
    </script>
</body>
</html>
```
/end_artifact('improved_travel_map.html', 'html')

–î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

1. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
   - –ü–æ–¥—Å—á–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ—Å–µ—â–µ–Ω–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤
   - –ü–æ–¥—Å—á–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å—Ç—Ä–∞–Ω

2. –§–∏–ª—å—Ç—Ä –ø–æ —Ü–≤–µ—Ç—É:
   - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –º–µ—Ç–∫–∏ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É —Ü–≤–µ—Ç—É
   - –ö–Ω–æ–ø–∫–∞ —Å–±—Ä–æ—Å–∞ —Ñ–∏–ª—å—Ç—Ä–∞

3. –≠–∫—Å–ø–æ—Ä—Ç/–ò–º–ø–æ—Ä—Ç –º–µ—Ç–æ–∫:
   - –≠–∫—Å–ø–æ—Ä—Ç —Ç–µ–∫—É—â–∏—Ö –º–µ—Ç–æ–∫ –≤ JSON-—Ñ–∞–π–ª
   - –ò–º–ø–æ—Ä—Ç –º–µ—Ç–æ–∫ –∏–∑ JSON-—Ñ–∞–π–ª–∞

4. –†–µ–∂–∏–º "–ú–µ—á—Ç—ã –æ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è—Ö":
   - –í–∏–∑—É–∞–ª—å–Ω–æ–µ –∑–∞—Ç—É—Ö–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –º–µ—Ç–æ–∫
   - –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –æ–¥–Ω–æ–π –∫–Ω–æ–ø–∫–æ–π

–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è:
- –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ —Å—Ç–∏–ª–∏
- –†–∞—Å—à–∏—Ä–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –º–µ—Ç–æ–¥–æ–≤
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Ç–µ–∫—É—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:
- –í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç
- –î–æ–±–∞–≤—å—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≥–æ—Ä–æ–¥–æ–≤
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –ª–µ–≤–æ–π –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

–•–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã —è –æ–±—ä—è—Å–Ω–∏–ª –ø–æ–¥—Ä–æ–±–Ω–µ–µ –∫–∞–∫—É—é-–ª–∏–±–æ –∏–∑ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π?
