```html
<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Travel Map с Firebase</title>

<!-- Google Fonts: Poppins for modern look -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300,400,600,700&display=swap" rel="stylesheet">
<!-- FontAwesome for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" integrity="sha512-..." crossorigin="anonymous" referrerpolicy="no-referrer" />

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

<style>
  /* Ваши стили остаются прежними, просто добавим несколько стилей для профиля и погоды */
  
  #profileModal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.8);
    justify-content: center;
    align-items: center;
  }

  .profile-content {
    background: white;
    padding: 20px;
    border-radius: 8px;
    width: 300px;
  }

  .weather-info {
    position: absolute;
    top: 15px;
    right: 15px;
    background: var(--bg-dark);
    padding: 10px;
    border-radius: var(--border-radius);
    display: none;
  }
</style>
</head>
<body>

<div id="toggleControlsBtn">
    <i class="fas fa-bars"></i>
</div>

<div id="controls">
  <h2><i class="fas fa-map-marked-alt"></i> Travel Map</h2>
  <div id="userInfo"></div>
  <button id="loginBtn"><i class="fab fa-google"></i> Войти через Google</button>
  <button id="logoutBtn" style="display:none;"><i class="fas fa-sign-out-alt"></i> Выйти</button>
  <button id="profileBtn" style="display:none;"><i class="fas fa-user"></i> Профиль</button>

  <hr style="border: 0; border-top: 1px solid #eee; margin: 20px 0;">

  <div class="autocomplete-container">
      <label for="cityInput">Введите город:</label>
      <input type="text" id="cityInput" autocomplete="off" placeholder="Например, Париж" />
      <div id="suggestions"></div>
  </div>

  <label for="colorInput">Цвет метки:</label>
  <input type="color" id="colorInput" value="#4CAF50" />

  <button id="addBtn">
      <span id="addBtnText"><i class="fas fa-plus-circle"></i> Добавить метку</span>
      <span id="addBtnLoader" class="loader"></span>
  </button>
</div>

<div id="map"></div>
<div class="weather-info" id="weatherInfo"></div>

<div id="notification-container"></div>

<!-- Profile Modal -->
<div id="profileModal">
  <div class="profile-content">
    <h3>Профиль</h3>
    <label for="avatarInput">Аватарка:</label>
    <input type="file" id="avatarInput" accept="image/*" />
    <label for="nameInput">Имя:</label>
    <input type="text" id="nameInput" placeholder="Введите ваше имя" />
    <label for="ageInput">Возраст:</label>
    <input type="text" id="ageInput" placeholder="Введите ваш возраст" />
    <label for="factsInput">Факты о себе:</label>
    <textarea id="factsInput" placeholder="Расскажите о себе"></textarea>
    <button id="saveProfileBtn">Сохранить</button>
    <button id="closeProfileBtn">Закрыть</button>
  </div>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- Firebase SDK (v9 Modular) -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import {
    getAuth,
    GoogleAuthProvider,
    signInWithPopup,
    signOut,
    onAuthStateChanged
  } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
  import {
    getFirestore,
    collection,
    addDoc,
    query,
    where,
    getDocs,
    updateDoc,
    doc
  } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyB0c7llONI831LKFmqTIH6393ZD4ZjBOZY",
    authDomain: "travel-map-f3677.firebaseapp.com",
    projectId: "travel-map-f3677",
    storageBucket: "travel-map-f3677.firebasestorage.app",
    messagingSenderId: "692883514599",
    appId: "1:692883514599:web:0b7a71587433e67a85ae42",
    measurementId: "G-M8L8K1DL29"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  
  const weatherInfo = document.getElementById("weatherInfo");
  const cityInput = document.getElementById("cityInput");
  const colorInput = document.getElementById("colorInput");
  const addBtn = document.getElementById("addBtn");
  const profileBtn = document.getElementById("profileBtn");
  const profileModal = document.getElementById("profileModal");
  const closeProfileBtn = document.getElementById("closeProfileBtn");
  const saveProfileBtn = document.getElementById("saveProfileBtn");
  const avatarInput = document.getElementById("avatarInput");
  const nameInput = document.getElementById("nameInput");
  const ageInput = document.getElementById("ageInput");
  const factsInput = document.getElementById("factsInput");
  
  const map = L.map("map").setView([55.751244, 37.618423], 5);

  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    maxZoom: 19,
    attribution: "© OpenStreetMap"
  }).addTo(map);

  let markers = [];
  let selectedCity = null;
  const provider = new GoogleAuthProvider();

  // Weather API configuration
  async function fetchWeather(lat, lon) {
    const apiKey = "YOUR_WEATHER_API_KEY";  // Place your Weather API key here
    const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&lang=ru&units=metric`;

    const response = await fetch(url);
    const data = await response.json();

    return data;
  }

  // Function to show weather based on clicked location
  map.on('click', async (e) => {
    const { lat, lng } = e.latlng;
    const weatherData = await fetchWeather(lat, lng);

    // Display weather info
    weatherInfo.innerHTML = `<strong>Погода в этом месте:</strong><br>${weatherData.weather[0].description}<br>Температура: ${weatherData.main.temp}°C`;
    weatherInfo.style.display = 'block';
    weatherInfo.style.left = `${e.originalEvent.pageX}px`;
    weatherInfo.style.top = `${e.originalEvent.pageY}px`;
  });

  // Show the profile modal
  profileBtn.addEventListener('click', () => {
    profileModal.style.display = 'flex';
  });

  // Close the profile modal
  closeProfileBtn.addEventListener('click', () => {
    profileModal.style.display = 'none';
  });

  // Save profile data
  saveProfileBtn.addEventListener('click', () => {
    const avatar = avatarInput.files[0];
    const name = nameInput.value;
    const age = ageInput.value;
    const facts = factsInput.value;

    // Here you'd generally save the profile info into Firestore
    // For the sake of this mockup, we'll just log it
    console.log({ avatar, name, age, facts });

    profileModal.style.display = 'none';
  });

  // Auth state change event
  onAuthStateChanged(auth, user => {
    if (user) {
      profileBtn.style.display = "inline-block";
      // Load user-specific markers
      loadUserMarkers(user.uid);
    } else {
      profileBtn.style.display = "none";
      clearMarkers();
    }
  });
  
  // Загрузка меток пользователя
  async function loadUserMarkers(userId) {
    clearMarkers();
    const markersQuery = query(
      collection(db, "markers"),
      where("userId", "==", userId)
    );

    try {
      const querySnapshot = await getDocs(markersQuery);
      querySnapshot.forEach(docSnap => {
        const data = docSnap.data();
        const idDoc = docSnap.id;

        const marker = L.circleMarker([data.lat, data.lon], {
          color: data.color,
          radius: 8,
          fillOpacity: 0.7,
          weight: 2,
          opacity: 0.8
        }).addTo(map);

        marker.bindPopup(createPopupContent(data.cityName, data.color, idDoc, marker));
        markers.push({ idDoc, marker, data });
      });
    } catch (e) {
      showNotification("Ошибка при загрузке меток: " + e.message, true);
    }
  }

  // Остальные функции (например, saveMarker, createPopupContent и т.д.) также остаются прежними. 
  // Загрузка меток при входе, и так далее.

  // Запуск карты
  map.setView([55.751244, 37.618423], 5);

</script>
</body>
</html>
```
